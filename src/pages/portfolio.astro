---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import ResponsiveMain from "../components/ResponsiveMain.astro";
import "../styles/portfolio.css";

// Import the getCollection function to fetch your content
import { getCollection } from "astro:content";

// Fetch the 'portfolio' collection, which contains all your .md files
const portfolio = await getCollection("portfolio");

// Sort the posts by date in descending order (newest first).
// This ensures the oldest posts are at the bottom.
portfolio.sort((a, b) => {
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});
---

<Layout>
    <Header />

    <div class="portfolio-wrapper">
        <ResponsiveMain>
            <i>
                This page is under construction :3
            </i>
            <p>
                While the website's source code is published under the <a href="https://opensource.org/license/MIT" target="_blank">MIT License</a>, I <b>reserve all rights</b> to all the content published here, like the articles in this portfolio, my projects, etc. For more information, read <a href="https://github.com/sokiGit/portfolio-v0/blob/main/README.md" target="_blank">README.md</a>.
            </p>

            <!-- Use a loop to iterate over each post in the sorted collection -->
                {
                    portfolio.map(async (submission) => {
                        // Get the title from the submission's data
                        const title = submission.data.title || "Untitled Post";
                        
                        // Await the render function to get the component for this post
                        const { Content } = await submission.render();
                        
                        return (
                            // Wrap the rendered content in a container, adding a title
                            <article class="portfolio-article" id={submission.slug}>
                            <section class="portfolio-article-metadata">
                                <h1>{title}
                                    <span class="portfolio-article-title-quick-actions">
                                        <a data-icon="link" href={"#"+submission.slug} title="Link to this article"></a>
                                        <a data-icon="open" href={"/portfolio/"+submission.slug} title="Open this article in a new tab"></a>
                                    </span>
                                    </h1>
                                <i class="portfolio-article-date">{submission.data.date || "Unknown date."}</i>
                                <i class="portfolio-article-categories">Categories: {submission.data.categories.toString() || "None"}</i>
                            </section>
                            <section class="portfolio-article-content">
                                <Content />
                            </section>
                        </article>
                    );
                })
            }
        </ResponsiveMain>

        <div class="portfolio-navbar">
            Portfolio Navigation
            <ul>
                {
                    portfolio.map((submission) => {
                        const title = submission.data.title || "Untitled Post";
                        return (
                            <li>
                                <a href={"#"+submission.slug}>{title}</a>
                            </li>
                        );
                    })
                }
            </ul>
        </div>
    </div>
</Layout>